---
title: "세그먼트 트리 실전 테크닉"
description: ""
tags: ["Algorithm","Segment Tree"]
date: "2023-04-09"
thumbnail: ""
---

> 단순 최소, 최대 구간 쿼리가 아닌 이게 세그먼트 트리로 해결이 가능하다고? 라고 생각할 만한 문제들을 해결 할 수 있도록 하는 아이디어 모음집입니다.


<!-- Table of Contents -->

# 개요

일반적으로 한 요소에 대해 정렬 후 다른 요소의 존재 여부 혹은 

# 2-elements

대표적으로 Inversion Counting, LIS 문제들을 해당 테크닉으로 해결 할 수 있습니다.


# 3-elements

일반적으로 3가지 요소가 모두 작거나 큰 객체의 존재성을 묻는 문제들이 있습니다.

이를 해결하는 테크닉은 다음과 같습니다:

1. 1가지 요소에 대하여 정렬
1. 정렬한 요소를 제외한 나머지 2번째 요소에 대해 트리에 쿼리를 날린후, 받은 값에 대해 3번째 요소와 비교.
> 💡 일반적으로 2번째 요소의 위치를 N이라고 할 때, 1… N-1까지 쿼리를 날려 받은 값으로 3번째 요소와 비교하여 존재성을 따집니다.

1. 2번째 요소의 위치에 3번째 요소에 대한 값을 트리에 업데이트
## 예제

[https://www.acmicpc.net/problem/2336](https://www.acmicpc.net/problem/2336)

  <details>
  <summary>코드 펼치기</summary>

</details>

상단의 테크닉을 이용하여 해당 문제를 해결한 사고 순서는 다음과 같습니다.

세그먼트 트리는 RMQ로 선언하였습니다.

1. (N+1) X 3 크기의 배열을 선언 후, 배열의 첫번째 인덱스는 학생의 성적, 두번째 인덱스는 입력의 각 줄.
1. 첫번째 요소에 대해 오름차순 정렬
1. 트리의 기본 값을 학생 수의 최댓값 + 1로 설정
1. 각 배열의 두번째 요소의 값이 i 라고 할 때 1…i-1 사이의 최솟값을 구함
1. 구해진 최솟값을 세번째 요소와 비교하여 세번째 요소보다 크다면 ‘굉장한’ 학생 수 증가
1. 위치 i에 세번째 요소를 구간 트리에 업데이트
> 💡 


# 이분탐색? + 세그트리

어떤 수열 집합과 집합의 원소마다 조건 (앞의 수가 자신보다 작을 경우 or 클 경우 등등)이 주어졌을 때 원래의 수열을 찾는 문제에 사용가능한 테크닉입니다.

이러한 문제의 일반적인 해결 방법은 다음과 같습니다.

1. 수열 집합을 정렬한다.
1. 구간 합 트리를 선언하고 각 트리 노드에 1을 부여한다.
1. 주어진 조건을 순회하며 트리의 분기마다 왼쪽 혹은 오른쪽 트리로 갈 지 결정한다. 그리고 지나간 노드마다 -1을 더한다.
> 💡 트리의 분기마다 왼쪽 혹은 오른쪽으로 가는 것은 이분탐색에서 값에 따라 중간값을 기준으로 왼쪽 혹은 오른쪽으로 가는 것과 같은 아이디어 입니다.

1. 트리의 리프에 도달하면 적절한 후처리를 한다.
## 예제

[https://www.acmicpc.net/problem/2465](https://www.acmicpc.net/problem/2465)

  <details>
  <summary>코드</summary>

</details>

이 문제를 해결 할 수 있었던 사고 과정은 다음과 같습니다.

1. 수열 집합과 그 수열의 원래 모습일 때의 규칙을 정의한 배열이 주어졌을 때는 정의된 규칙이 수열의 어떤 점을 기준으로 만들어 졌는지 파악한다.
1. 여기서는 원래 수열이었을 떄 앞 사람들 중 자기보다 키가 작거나 같은 사람들의 수가 정의된 규칙이다.
1. 주어진 수열 집합을 오름차순 정렬 후, 구간 합 트리를 생성하여 앞에 k명 있으려면 키가 몇이어야 되는지 찾는 갱신 함수를 구현한다.

[https://www.acmicpc.net/problem/9426](https://www.acmicpc.net/problem/9426)

  <details>
  <summary>코드</summary>

</details>

처음에 봤을 떄 세그먼트 트리 문제인지 전혀 몰랐습니다. 후에 풀이를 보고나서야 세그트리를 이분 탐색처럼 사용한다는 것을 알았습니다.

이 문제를 해결하기 위한 방법은 다음과 같습니다.

1. 구간 합 트리를 온도에 대하여 생성한다.
1. 먼저 K-1번째 온도까지 구간 합 트리에 업데이트 한다.
1. K번째 온도부터 N번째 온도까지 순회하며 윈도우 밖으로 나가는 온도는 트리에서 제거하고 들어오는 온도는 추가한다.
# 세그먼트 트리 비재귀로 구현하기

비트마스크를 이용하여 짧고 간결하게 구현할 수 있습니다.

[https://seungwuk98.tistory.com/37](https://seungwuk98.tistory.com/37)

# 금광 세그트리

구간내의 최대 부분합을 구하는 방법으로 “금광” 이라는 문제에 이 기법이 사용되어 유명해졌습니다.

어떤 노드에 대해서 최대 부분합을 가지고 있다고 생각해보면 두개의 노드를 합칠 때 두개의 구간을 겹치는 부분합에 대한 정보를 알 수 없습니다. 따라서 해당 쿼리를 수행하기 위해 노드에 다음과 같은 정보를 저장합니다.


노드를 합칠 때는 다음과 같은 연산을 수행합니다.

$L$을 왼쪽 자식 노드, $R$을 오른쪽 자식노드라고 정의하면,

## 예제

[https://www.acmicpc.net/problem/16993](https://www.acmicpc.net/problem/16993)

  <details>
  <summary>코드</summary>

</details>

대표적인 금광세그 문제입니다.


[https://www.acmicpc.net/problem/15561](https://www.acmicpc.net/problem/15561)

  <details>
  <summary>코드</summary>

</details>

16993번 문제에서 다항식 변환을 통해 풀 수 있는 문제입니다.

처음에 합치는 부분에서 다항식을 새로 적용한 값을 추적할까 생각했지만 기존 금광세그 합치기 연산에서 최대부분합을 계산할 때 저절로 그 범위를 계산한다는 것을 알게 되었다.

따라서 초기값만을 `U x X + V` 으로 수정함으로써 1번 쿼리를 구할 수 있음을 알았다.


[https://www.acmicpc.net/problem/10167](https://www.acmicpc.net/problem/10167)

  <details>
  <summary>코드</summary>

</details>

플레인 스위핑 + 금광 세그를 어떻게 도입할지 굉장히 많은 고민을 했던 문제이다.

금광 세그로 1차원 배열에 대한 최대 부분합을 구할 수 있으니 플레인 스위핑으로 y축에 대해 휩쓸며 계산해주면 된다.

<!-- Unknown block type: unsupported -->


[https://www.acmicpc.net/problem/13557](https://www.acmicpc.net/problem/13557)

  <details>
  <summary>코드</summary>

</details>

아이디어는 어렵지 않으나 에지 케이스 처리가 까다로운 문제다.

구간이 겹칠 때 3구간으로 분할하여 처리하는 부분만 주의하여 풀면 되는 문제


# 오일러 경로 테크닉 + 세그트리

## 예제

[https://www.acmicpc.net/problem/18227](https://www.acmicpc.net/problem/18227)

  <details>
  <summary>코드</summary>

</details>

그래프의 높이를 쿼리마다 곱해준다는 아이디어만 떠올리면 평범한 오일러 경로 테크닉 문제이다.

