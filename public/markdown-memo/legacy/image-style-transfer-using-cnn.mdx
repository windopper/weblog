---
title: "Image Style Transfer Using CNN"
description: ""
tags: ["Style Transfer","Paper Review","ML"]
date: "2023-01-20"
thumbnail: "/markdown-memo/legacy/images/5ef6bb14-111a-4d37-aca3-8580ae20f7af.png"
---


<!-- Table of Contents -->

# ê°œìš”

ì €ìëŠ” ì´ë¯¸ì§€ë¥¼ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ì˜ semantic contentë¡œ ë Œë”ë§ í•˜ëŠ” ê²ƒì€ ì–´ë ¤ìš´ ì´ë¯¸ì§€ í”„ë¡œì„¸ì‹± íƒœìŠ¤í¬ë¼ê³  ë§í•˜ë©° ê°ì²´ ê²€ì¶œì— ìµœì í™”ëœ CNNì„ í•´ë‹¹ ëª¨ë¸ì˜ image representationì„ ì¶”ì¶œí•˜ëŠ”ë° ì‚¬ìš©í–ˆë‹¤ê³  ë§í•œë‹¤.

ë˜í•œ í•´ë‹¹ ëª¨ë¸ì€ ì´ë¯¸ì§€ì˜ content ì™€ style ë¥¼ ë¶„ë¦¬í•˜ê³  í•©ì¹  ìˆ˜ ìˆë‹¤ê³  ì†Œê°œí•˜ë©° CNNì— ì˜í•´ì„œ í•™ìŠµëœ image representationì´ ê³ ìˆ˜ì¤€ì˜ ì´ë¯¸ì§€ synthesisì™€ manipulationì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ê°€ëŠ¥ì„±ì„ ì¦ëª…í•˜ì—¬ í•´ë‹¹ ë¶„ì•¼ì— ëŒ€í•œ ìƒˆë¡œìš´ insightë¥¼ ì œê³µí–ˆë‹¤ê³  í•œë‹¤.


ì €ìëŠ” Introductionì—ì„œ í•œ ì´ë¯¸ì§€ì˜ ìŠ¤íƒ€ì¼ì„ ë‹¤ë¥¸ ì´ë¯¸ì§€ì˜ ìŠ¤íƒ€ì¼ë¡œ ì „ì†¡í•˜ëŠ” ê²ƒì€ texture transferì˜ ë¬¸ì œë¡œ ë³´ì•˜ë‹¤.

texture transferì€ ì›ë³¸ ì´ë¯¸ì§€ì˜ textureë¥¼ íƒ€ê²Ÿ ì´ë¯¸ì§€ì˜ semantic contentë¥¼ ë³´ì¡´í•˜ë©° textureë¥¼ í•©ì„±í•˜ëŠ” ê²ƒì„ ëœ»í•œë‹¤.

ê¸°ì¡´ì˜ texture synthesisì€ ì£¼ì–´ì§„ ì›ë³¸ tetureì˜ í”½ì…€ë“¤ì„ resampling í•˜ì—¬ ìì—°ìŠ¤ëŸ½ê²Œ í•©ì„±í•  ìˆ˜ ìˆëŠ” non-parametric ì•Œê³ ë¦¬ì¦˜ë“¤ì´ ìˆë‹¤.

ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ì•Œê³ ë¦¬ì¦˜ë“¤ì€ ê´„ëª©í•  ë§Œí•œ ì„±ê³¼ë¥¼ ëƒˆìŒì—ë„ ëª¨ë‘ ê°™ì€ ê·¼ë³¸ì ì¸ í•œê³„ì ì´ ì¡´ì¬í–ˆë‹¤.

í•´ë‹¹ ì•Œê³ ë¦¬ì¦˜ë“¤ì€ texture transferë¥¼ í•˜ê¸° ìœ„í•´ target imageì˜ low-level image features ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ë…¼ë¬¸ì—ì„œ ì œì‹œí•˜ëŠ” style transfer ì•Œê³ ë¦¬ì¦˜ì€ target imageì˜ semantic image content ë¥¼ ì¶”ì¶œ í•  ìˆ˜ ìˆê³  ì´ë¥¼ í†µí•˜ì—¬ source imageì˜ styleì—ì„œ target imageì˜ semantic contentë¥¼ render í•˜ê¸° ìœ„í•´ texture transfer ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

ê·¼ë³¸ì ì¸ ì „ì œì¡°ê±´ì€ semantic image content ì™€ style ì—ì„œ ë…ë¦½ì ì¸ model variationsê°€ ì£¼ì–´ì§€ëŠ” image representationsì„ ì°¾ëŠ” ê²ƒì´ë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ natural image (ì¼ë°˜ì ì¸ ì´ë¯¸ì§€) ì—ì„œ styleê³¼ contentë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë§¤ìš° ì–´ë ¤ìš´ ë¬¸ì œì´ì§€ë§Œ, ìµœê·¼ì˜ DCNN (Deep Convolutional Neural Networks) ì˜ ë°œì „ìœ¼ë¡œ natural imageì—ì„œ ê³ ìˆ˜ì¤€ì˜ semantic informationì„ ì¶”ì¶œí•˜ëŠ” ê²ƒì„ í•™ìŠµí•œ ê°•ë ¥í•œ computer vision ì‹œìŠ¤í…œë“¤ì´ ë“±ì¥í•˜ì˜€ë‹¤.

ì €ìëŠ” í•´ë‹¹ ì‹œìŠ¤í…œë“¤ì„ ì´ìš©í•˜ì—¬ natural imagesì—ì„œ content ì™€ styleì„ manipulate ë˜ëŠ” synthesis í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ë§Œë“¤ì—ˆë‹¤.

# ê³¼ì •

![](/markdown-memo/legacy/images/5ef6bb14-111a-4d37-aca3-8580ae20f7af.png)


# Deep Image Representations

ëª¨ë¸ì€ ê¸°ë³¸ì ìœ¼ë¡œ VGG ë„¤íŠ¸ì›Œí¬ ìœ„ì—ì„œ ì‘ë™í•œë‹¤.

**16ê°œì˜ í•©ì„±ê³± ì‹ ê²½ë§ê³¼ 5ê°œì˜ í’€ë§ ì¸µ**ì„ ê°€ì§„ VGG-19 ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.

ì €ìëŠ” ì‹ ê²½ë§ì˜ ê°ê°ì˜ í•©ì„±ê³± í•„í„°ë“¤ì˜ ê°€ì¤‘ì¹˜ë“¤ì„ scaling í•˜ì—¬ ì •ê·œí™”ì‹œì¼œ ì£¼ì—ˆë‹¤.

image synthesis ì—ì„œ ì €ìëŠ” ë§¥ìŠ¤ í’€ë§ì„ í‰ê·  í’€ë§ìœ¼ë¡œ ë°”ê¾¸ëŠ” ê²ƒì´ ì•½ê°„ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ì—ˆê¸°ì— í‰ê·  í’€ë§ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

# Content Representation

$N_l$ â†’ í•œ ë ˆì´ì–´ì˜ í•„í„° ìˆ˜. ì¦‰, ì±„ë„ ìˆ˜

$M_l$ â†’ feature mapì˜ ë„ˆë¹„ì™€ ë†’ì´ì˜ ê³±

$F^l_{ij}$ â†’ $j$ ë²ˆì§¸ ë ˆì´ì–´ $l$ ì˜ $i^{th}$ë²ˆì§¸ í•„í„°ì´ë©°  $F^l âˆˆ R^{N_l\times{M_l}} $ ë¡œ í‘œí˜„ê°€ëŠ¥

$\vec{p}$ â†’ original image

$\vec{x}$ â†’ generated image

$P^l$ â†’ original imageì˜ layer $l$ ì— ëŒ€í•œ feature representation

$F^l$ â†’ generated imageì˜ layer $l$ ì— ëŒ€í•œ feature representation


encoded ë˜ì–´ ìˆëŠ” ë‹¤ì–‘í•œ ê³„ì¸µì˜ image informationì„ ì‹œê°í™” í•˜ëŠ” ë°©ë²•ì€ original imageì˜ feature responsesì™€ match í•˜ëŠ” ë‹¤ë¥¸ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ white noise imageì— ê²½ì‚¬í•˜ê°•ë²•ì„ ì‹œí–‰í•˜ì—¬ ì•Œ ìˆ˜ ìˆë‹¤.


original imageì™€ generated imageì‚¬ì´ì˜ ì œê³± ì˜¤ì°¨ ì†ì‹¤ì— ëŒ€í•œ ì •ì˜ì´ë‹¤.

![](/markdown-memo/legacy/images/ab33a32c-94ef-46f1-9e29-e6a445b04e8f.png)


ìƒë‹¨ì— ì •ì˜í•œ ì†ì‹¤ì— ëŒ€í•œ ë¯¸ë¶„

![](/markdown-memo/legacy/images/c6fa9ccc-938f-40fb-8e11-a25bd3dfe094.png)

ê°ê°ì˜ ì´ë¯¸ì§€ $\vec{x}$ë“¤ì€ standard error back-propagation ì„ í†µí•˜ì—¬ ê³„ì‚° í•  ìˆ˜ ìˆë‹¤.

CNN ë„¤íŠ¸ì›Œí¬ê°€ ê°ì²´ ì¸ì‹ íƒœìŠ¤í¬ì— ëŒ€í•´ í›ˆë ¨ë  ë•Œ ë§ˆë‹¤ ì‹ ê²½ë§ì€ processing hierarchy ì— ë”°ë¼ object information ë¥¼ ì•”ì‹œì ìœ¼ë¡œ ì´ë¯¸ì§€ì˜ representationì„ ê°œë°œí•˜ë„ë¡ ë§Œë“ ë‹¤.

ì‹ ê²½ë§ì˜ processing hierarchyì— ë”°ë¼ ì…ë ¥ ì´ë¯¸ì§€ëŠ” ì ì  ì´ë¯¸ì§€ì˜ actual contentì— ê°€ê¹Œì›Œì§€ëŠ” representationìœ¼ë¡œ ë³€í™˜ëœë‹¤. ê·¸ëŸ¬ë‚˜ ì…ë ¥ ì´ë¯¸ì§€ëŠ” ì´ë¯¸ì§€ì˜ precise appearanceì—ì„œ relatively invariant ëœë‹¤.

ë”°ë¼ì„œ ì‹ ê²½ë§ì˜ ë†’ì€ ì¸µì—ì„œëŠ” ê°ì²´ì˜ ë²”ìœ„ì—ì„œ high-level contentë¥¼ í¬ì°©í•˜ê³  ì…ë ¥ ì´ë¯¸ì§€ì— ëŒ€í•œ arrangement ë“¤ì€ reconstructionì˜ ì‹¤ì œ í”½ì…€ ê°’ì„ ê·¸ë ‡ê²Œ ë§ì´ ì œí•œí•˜ì§€ ì•ŠëŠ”ë‹¤.

ë°˜ëŒ€ë¡œ, ë‚®ì€ ì¸µì—ì„œì˜ reconstructionsì€ original imageì˜ exact pixel valuesë¥¼ reproduce í•œë‹¤.

# Style Representation

ì…ë ¥ ì´ë¯¸ì§€ì— ëŒ€í•œ styleì˜ representationì„ ì–»ê¸° ìœ„í•´ì„œëŠ” texture informationì„ í¬ì°©í•˜ë„ë¡ ì„¤ê³„ëœ feature spaceë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

í•´ë‹¹ feature spaceëŠ” ì‹ ê²½ë§ì˜ ì–´ë–¤ ì¸µì—ì„œë“  filter responseì˜ ê¼­ëŒ€ê¸°ì— ì„¤ì¹˜ë  ìˆ˜ ìˆë‹¤.

feature spaceëŠ” ë‹¤ì–‘í•œ filter responsesë“¤ ì‚¬ì´ì—ì„œì˜ correlationì„ êµ¬ì„±í•˜ë©°, ì´ëŠ” feature mapì˜ ê³µê°„ì  ë²”ìœ„ì— ëŒ€í•œ ê¸°ëŒ€ê°€ ì´ë£¨ì–´ì§„ë‹¤.

ì´ëŸ¬í•œ **feature correlations**ì€ ê·¸ëŒ í–‰ë ¬ë¡œ ì£¼ì–´ì§„ë‹¤. ì´ëŠ” ì‹ ê²½ë§ ì¸µ $l$ì—ì„œì˜ ë²¡í„°í™” ëœ feature map $i$ ì™€ $j$ ì‚¬ì´ì˜ **inner product**ë¡œ ê³„ì‚°ëœë‹¤.

<!-- Unknown block type: link_to_page -->

$G^l\in{\R^{N_1\times{N_1}}}$

$G^l_{ij}=\sum\limits_k{F^l_{ik}F^l_{jk}}$

ì—¬ëŸ¬ ì¸µì—ì„œì˜ feature correlations ë“¤ì„ í¬í•¨í•˜ì—¬, global arrangement ê°€ ì•„ë‹Œ ì…ë ¥ ì´ë¯¸ì§€ì˜ texture informationì„ í¬ì°©í•˜ì—¬ stationary í•˜ê³  multi-scale í•œ representationì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

ë˜, ìš°ë¦¬ëŠ” ì£¼ì–´ì§„ ì…ë ¥ ì´ë¯¸ì§€ì˜ style representationì— ë§ëŠ” ì´ë¯¸ì§€ë¥¼ constructing í•¨ìœ¼ë¡œì¨ ì‹ ê²½ë§ì˜ ë‹¤ì–‘í•œ ì¸µì— ìˆëŠ” style feature spacesë¥¼ í¬ì°©í•˜ì—¬ í•´ë‹¹ informationë¥¼ ì‹œê°í™” í•  ìˆ˜ ìˆë‹¤.

ì´ë¥¼ ì‹œê°í™”í•˜ê¸° ìœ„í•´ì„œëŠ” white noise image ì—ì„œ original imageì— ëŒ€í•œ ê·¸ëŒ í–‰ë ¬ ê°’ê³¼ generated imageì˜ ê·¸ëŒ í–‰ë ¬ ì‚¬ì´ì˜ mean squared distanceë¥¼ ìµœì†Œí™”í•˜ì—¬ ê²½ì‚¬í•˜ê°•ë²•ì„ ì‹œí–‰í•˜ì—¬ì•¼ í•œë‹¤.

$\vec{a}$ì™€ $\vec{x}$ë¥¼ ê°ê° original imageì™€ generated imageë¼ê³  í•˜ê³ , $A^l$ì™€ $G^l$ë¥¼ ê°ê° ì‹ ê²½ë§ ì¸µ $l$ì—ì„œì˜ style representation ì´ë¼ê³  í•˜ë©´, ì„ íƒí•œ ì¸µ $l$ì˜ ì´ ì†ì‹¤ ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

![](/markdown-memo/legacy/images/c172047e-023e-4fce-9d9f-4e0644cc77a8.png)

ê·¸ë¦¬ê³  ì´ style ì†ì‹¤ ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

![](/markdown-memo/legacy/images/c8ea345e-2159-4bb7-8015-9a27078d65bd.png)

$w_l$ì€ ê°€ì¤‘ì¹˜ë¡œ ê° ì¸µì˜ total lossì— ëŒ€í•œ ê¸°ì—¬ë„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

í™œì„±í™” ì¸µì— ë”°ë¥¸ $E_l$ì˜ ë¯¸ë¶„ì€ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°ëœë‹¤.

![](/markdown-memo/legacy/images/2a5222b1-19d0-4894-8ad7-3b307cda2bb2.png)


> ğŸ’¡ *- Style Representationì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” ê·¸ëŒ í–‰ë ¬ì„ í†µí•˜ì—¬ ê³„ì‚°í•œë‹¤.
- ì›ë³¸ ì´ë¯¸ì§€ì™€ ìƒì„±ëœ ì´ë¯¸ì§€ì˜ ê·¸ëŒ í–‰ë ¬ì„ ê°ê° êµ¬í•˜ì—¬ ì£¼ì–´ì§„ ì†ì‹¤ í•¨ìˆ˜ë¥¼ ìµœì†Œí™” í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ styleë¥¼ ìœ ì‚¬í•˜ê²Œ ë§Œë“ ë‹¤.*


# Style Transfer

artworkì˜ styleì¸ $\vec{a}$ì„ photographì¸ $\vec{p}$ì— ìŠ¤íƒ€ì¼ì„ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ì— $\vec{p}$ì˜ content representationê³¼ $\vec{a}$ì˜ style representationì„ ë™ì‹œì— í•©ì„±ì‹œì¼œ ì£¼ì–´ì•¼ í•œë‹¤.

ë”°ë¼ì„œ photographì˜ content representationê³¼ white noise imageì˜ feature representationì˜ ê±°ë¦¬ì™€ CNNì˜ ì •ì˜ëœ ì¸µì—ì„œì˜ artworkì˜ style representationì˜ ê±°ë¦¬ì˜ í•©ì„ ê²°í•¨í•œ ì‹ì„ ìµœì†Œí™” ì‹œì¼œì•¼í•œë‹¤.

ìš°ë¦¬ê°€ ìµœì†Œí™” í•  ì†ì‹¤ í•¨ìˆ˜ëŠ” 

![](/markdown-memo/legacy/images/8d942f1b-70eb-4469-a424-7ff4ff5c00fe.png)

$\alpha$ì™€ $\beta$ëŠ” contentì™€ style reconstructionì˜ ê°ê°ì˜ ê°€ì¤‘ì¹˜ì´ë‹¤.

ê°ê°ì˜ í”½ì…€ ê°’ì— ë”°ë¥¸ ì†ì‹¤ í•¨ìˆ˜ì˜ ê¸°ìš¸ê¸°ì¸ ${\partial{L_{total}}}\over{\partial\vec{x}}$ numerical optimisation strategyë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.

ë…¼ë¬¸ì—ì„œëŠ” **L-BFGS** ë¼ëŠ” optimization ì•Œê³ ë¦¬ì¦˜ì´ image synthesis ê³¼ì •ì—ì„œ ê°€ì¥ ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì˜€ë‹¤ê³  í•œë‹¤.

image informationì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” feature representation ì„ ê³„ì‚°í•˜ê¸° ì´ì „ì— style imageë¥¼ content imageì™€ ê°™ì€ í¬ê¸°ë¡œ ë§ì¶°ì£¼ì–´ì•¼ í•œë‹¤.

> ğŸ’¡ *- style transferì˜ ì†ì‹¤í•¨ìˆ˜ëŠ” content lossì™€ style lossì˜ ê²°í•©ìœ¼ë¡œ ì •ì˜ë˜ë©° í•´ë‹¹ lossë“¤ì˜ ë¹„ìœ¨ì€ ì¡°ì ˆë  ìˆ˜ ìˆë‹¤.
*- style transferì„ ì§„í–‰í•˜ê¸° ì „ì— style imageì™€ content imageë¥¼ ê°™ì€ í¬ê¸°ë¡œ resize í•´ì•¼ í•œë‹¤.


# Results

í•´ë‹¹ ë…¼ë¬¸ì—ì„œì˜ ì£¼ìš” ë°œê²¬ì€ í•©ì„±ê³± ì‹ ê²½ë§ì—ì„œì˜ contentì™€ styleì˜ representationì€ ë¶„ë¦¬ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

ì˜ë¯¸í•˜ëŠ” ë°”ëŠ”, perceptually meaningful í•œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ë‚´ê¸° ìœ„í•´ì„œ ë…ë¦½ì ìœ¼ë¡œ representationë“¤ì„ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

í•´ë‹¹ ë°œê²¬ì„ ì…ì¦í•˜ê¸° ìœ„í•´ì„œ ë…¼ë¬¸ì—ì„œëŠ” ë‘ ê°€ì§€ì˜ ë‹¤ë¥¸ ì´ë¯¸ì§€ë¡œë¶€í„°  contentì™€ style representationì„ ì„ì–´ì„œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì˜€ë‹¤.

ì´ ë…¼ë¬¸ì—ì„œëŠ” Fig3 ì—ì„œ ì œì‹œí•œ ì´ë¯¸ì§€ë“¤ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„œ `conv4_2` ì˜ ì¸µì—ì„œ *content representation* ì„ `conv1_1, conv2_1, conv3_1, conv4_1, conv5_1`ì˜ ì¸µì—ì„œ *style representation*ì„ ì¶”ì¶œí•˜ì—¬ í•©ì„±ì‹œì¼°ë‹¤.


$\alpha/\beta$ì˜ ë¹„ìœ¨ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

Bì˜ ê·¸ë¦¼ â†’ $1\times10^{-3}$

Cì˜ ê·¸ë¦¼ â†’ $8\times10^{-4}$

Dì˜ ê·¸ë¦¼ â†’ $5\times10^{-3}$

Eì™€ Fì˜ ê·¸ë¦¼ â†’ $5\times10^{-4}$


![](/markdown-memo/legacy/images/c46b4225-b04b-4e45-aadf-e4712350cd51.png)


# Implementation

<!-- Unknown block type: link_to_page -->

# References

[https://aigong.tistory.com/359](https://aigong.tistory.com/359)

[https://openaccess.thecvf.com/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf](https://openaccess.thecvf.com/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf)

